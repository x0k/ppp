#!/usr/bin/bash -xe

d:
  pnpm run dev

c:
  pnpm run check

b:
  pnpm run build

p:
  pnpm run preview

# Artifacts
a/:
  go/:
    pushd packages/testing-go/go
    build:
      GOOS=js GOARCH=wasm go build -o ../public/compiler.wasm cmd/compiler/main.go
    popd
  rust/:
    pushd packages/testing-rust/rust
    # wget url && tar -xzvf file_name.tar.gz
    wasi-sdk:
      if [ ! -f wasi-sdk-20.0-linux.tar.gz ]; then
        wget https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-20/wasi-sdk-20.0-linux.tar.gz
        tar -xzvf wasi-sdk-20.0-linux.tar.gz
      fi
    build-wasm:
      ./x.py install
    copy-wasm:
      cp dist/bin/miri.wasm ../public
      cp -r dist/lib/rustlib/x86_64-unknown-linux-gnu/lib ../public/lib
    wasm: wasi-sdk build-wasm copy-wasm
    popd
  build: go/build
